extends ../_layout.jade

block append head-styles
  link(rel='stylesheet', href='/map/css/map.css?#{meta.version}')
  //todo: above link for build /map/css/map.css vs local ./css/map.css
  link(rel='icon', href='/css/images/favicon.png')
  link(rel='stylesheet', href='http://js.arcgis.com/#{meta.esriVersion}/esri/css/esri.css')
  link(rel='stylesheet', href='http://fonts.googleapis.com/css?family=Fira+Sans:400,500,300')
  link(rel='stylesheet', href='../vendors/kalendae/build/kalendae.css')
  style
    :stylus
      @require 'css/_base'
      @require 'css/_critical'

block append head-scripts
  script(src='../vendors/jquery/dist/jquery.min.js')
  script(src='../vendors/kalendae/build/kalendae.standalone.js', async)
  script.
    var base = location.pathname.replace(/\/[^/]+$/, '/map/');
    var dojoConfig = {
      parseOnLoad: false,
      async: true,
      cacheBust: 'v=#{meta.version}',
      packages: [
        { name: 'js', location: base + 'js' },
        { name: 'utils', location: base + 'js/utils' },
        { name: 'stores', location: base + 'js/stores' },
        { name: 'helpers', location: base + 'js/helpers' },
        { name: 'actions', location: base + 'js/actions' },
        { name: 'components', location: base + 'js/components' },
        { name: 'vendors', location: base + '../vendors' }
      ],
      aliases: [
        ['alt', 'vendors/alt/dist/alt.min'],
        ['react', 'vendors/react/react.min'],
        ['react-dom', 'vendors/react/react-dom.min'],
        ['react-motion', 'vendors/react-motion/build/react-motion'],
        ['lodash', 'vendors/lodash/lodash.min'],
        ['babel-polyfill', 'vendors/babel-polyfill/browser-polyfill'],
        ['formsy-react', 'vendors/formsy-react/release/formsy-react'],
        ['chosen', 'vendors/chosen/chosen.jquery']
      ],
      deps: ['dojo/domReady!'],
      callback: function () {
        // Set up globals
        window.app = {
          version: '#{meta.version}',
          debugEnabled: true,
          mobile: function () {return (window.matchMedia === undefined ? false : window.matchMedia('only screen and (max-width: 850px)').matches)},
          debug: function (message) {
            if (this.debugEnabled) {
              var print = typeof message === 'string' ? console.log : console.dir;
              print.apply(console, [message]);
            }
          }
        };
        require(['js/main']);
      }
    };

block content
  +navigation(global.pages, 'map', true)
  include html/_svgAssets.jade
  div#root.layout-content
  div#layer-modal.modal.hidden
  div#canopy-modal.modal.hidden
  div#basemap-modal.modal.hidden
  div#calendar-modal.modal.hidden
  div#subscription-modal.modal.hidden
  div#share-modal.modal.hidden
  div#fires-modal.modal.hidden
  div#master-modal.modal.hidden
  script(src='http://js.arcgis.com/#{meta.esriVersion}/init.js', async)

define(["dojo/dom","dijit/registry","modules/HashController","modules/EventsController","views/home/HomeModel","dojo/_base/array","views/map/MapConfig"],function(dom,registry,HashController,EventsController,HomeModel,arrayUtil,MapConfig){var o={},initialized=!1,viewName="homeView",viewObj={viewId:"homeView",viewName:"home"},stopAnimation=!1;return o.init=function(){return initialized?(EventsController.switchToView(viewObj),void 0):(require(["dojo/text!views/home/home.html"],function(e){initialized=!0,dom.byId(viewName).innerHTML=e,EventsController.switchToView(viewObj),HomeModel.applyBindings(viewName),EventsController.getPeats(),EventsController.startModeAnim()}),void 0)},o.startModeAnim=function(){console.log("start mode animation"),stopAnimation=!1;var e=1,o=function(e){var o=HomeModel.vm.homeModeOptions(),t=arrayUtil.map(o,function(o,t){return o.display=t===e?!0:!1,o});HomeModel.vm.homeModeOptions([]),HomeModel.vm.homeModeOptions(t)};o(e),require(["dojo/fx","dojo/_base/fx","dojo/query"],function(t,i,n){var r=function(a){var s=n(".modeGroup"),l=s.length,d=t.chain([i.animateProperty({node:s[a],properties:{marginLeft:{start:0,end:-350},opacity:{start:1,end:0}},onEnd:function(){var t;l-1>e?(t=e+1,e++):(t=0,e=0),setTimeout(function(){stopAnimation||(o(t),setTimeout(function(){stopAnimation||r(t)},4e3))},250)},units:"px",duration:500})]);d.play()};r(e)})},o.getPeats=function(){require(["modules/Loader","dojo/promise/all"],function(e,o){var t=new Date,i=new Date;i.setDate(t.getDate()-8);var n=i.getFullYear(),r="00"+(i.getMonth()+1).toString();r=r.substr(r.length-2);var a="00"+i.getDate().toString();a=a.substr(a.length-2);var s=n.toString()+"-"+r+"-"+a,l={layer:"http://gis-potico.wri.org/arcgis/rest/services/Fires/FIRMS_ASEAN/MapServer/0",where:"peat = 1 AND ACQ_DATE > date '"+s+" 12:00:00'",type:"executeForCount"},d=e.query(l),m={layer:"http://gis-potico.wri.org/arcgis/rest/services/Fires/FIRMS_ASEAN/MapServer/0",where:"ACQ_DATE > date '"+s+" 12:00:00'",type:"executeForCount"},u=e.query(m);o([d,u]).then(function(e){var o=e[0],t=e[1],i=Math.round(o/t*100),n=HomeModel.vm.homeModeOptions(),r=0,a="";arrayUtil.some(n,function(e,o){var t=e.html.indexOf("Fires occuring in peatland")>-1;return t&&(r=o,a=e.html.replace("Fires occuring in peatland","<p>"+i.toString()+" %</p> Fires occuring in peatland")),t}),n[r].html=a,HomeModel.vm.homeModeOptions(n)})})},o.handleDotClick=function(e){o.stopModeAnim(e)},o.stopModeAnim=function(e){if(console.log(e),stopAnimation=!0,e){var o=e.id,t=HomeModel.vm.homeModeOptions();HomeModel.vm.homeModeOptions([]);{arrayUtil.map(t,function(e,t){return e.display=o==t?!0:!1,HomeModel.vm.homeModeOptions.push(e),e})}}},o.getAnimStatus=function(){return stopAnimation},o.modeSelect=function(data){var selectedMode=data;eval("EventsController."+selectedMode.eventName+"()"),data.html&&data.html.search("latest imagery")>-1&&(console.log(data.html),require(["views/map/LayerController"],function(){MapConfig.digitalGlobe.navigationBool=!0}))},o.isInitialized=function(){return initialized},o});
define(["dojo/on","esri/Color","esri/graphic","utils/Helper","dojo/_base/array","esri/toolbars/draw","views/map/MapConfig","views/map/MapModel","esri/geometry/Polygon","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","dojo/i18n!esri/nls/jsapi"],function(e,a,o,r,i,t,s,n,l,c,d,u){"use strict";var w,m,b=!1,h=new c(c.STYLE_SOLID,new d(d.STYLE_SOLID,new a([255,0,0]),2),new a([103,200,255,0]));u.toolbars.draw.freehand="1. Click and hold to draw a shape. Release to finish. 2. Click in the shape to name it and subscribe.";var p={init:function(a){var o=this;w=a,m=new t(a),m.on("draw-end",this.drawComplete.bind(this)),e(document.getElementById("drawFeatures"),"click",function(){b?o.deactivateToolbar():o.activateToolbar()})},drawComplete:function(e){if(this.deactivateToolbar(),n.set("showDrawTools",!1),e.geometry){w.infoWindow.hide();var a,i,t=s.defaultGraphicsLayerUniqueId,c=s.defaultGraphicsLayerLabel,d=w.graphics,u=r.nextAvailableGraphicId(d,t),m={};m[t]=u,m[c]=["Custom Drawn Feature -",u].join(" "),i=new l(e.geometry),a=new o(i,h,m),d.add(a),n.vm.customFeaturesArray().push(a),n.vm.customFeaturesPresence(!0)}},activateToolbar:function(){m.activate(t.FREEHAND_POLYGON),b=!0,$("#drawFeatures").css("background-color","#e7002f")},deactivateToolbar:function(){m.deactivate(),b=!1,$("#drawFeatures").css("background-color","#444")},isActive:function(){return b}};return p});
define(["dojo/dom","dojo/ready","dojo/on","dojo/Deferred","dojo/dom-style","dojo/dom-class","dijit/registry","dojo/promise/all","dojo/_base/array","dojo/io-query","esri/map","esri/Color","esri/config","esri/layers/ImageParameters","esri/layers/ArcGISDynamicMapServiceLayer","esri/symbols/SimpleFillSymbol","esri/tasks/AlgorithmicColorRamp","esri/tasks/ClassBreaksDefinition","esri/tasks/GenerateRendererParameters","esri/renderers/UniqueValueRenderer","esri/layers/LayerDrawingOptions","esri/tasks/GenerateRendererTask","esri/tasks/query","esri/tasks/QueryTask","esri/tasks/StatisticDefinition","esri/graphicsUtils","esri/tasks/Date","views/map/MapConfig","views/map/MapModel","esri/request","knockout","libs/geostats","libs/highcharts"],function(e,t,r,i,a,o,n,s,l,u,d,c,f,p,y,b,h,g,m,F,I,w,v,_,C,T,S,D,E,O,M,A){var R={zoom:4,basemap:"gray",slider:!1,mapcenter:[120,-1.2],colorramp:[[252,221,209],[226,166,162],[199,111,116],[173,55,69],[147,1,22]],query_results:{},regionmap:{},maps:{},noFeatures:{pulpwoodQuery:"There are no fire alerts in pulpwood concessions in the AOI and time range.",palmoilQuery:"There are no fire alerts in palm oil concessions in the AOI and time range.",loggingQuery:"There are no fire alerts in logging concessions in the AOI and time range.",adminQuery:"There are no fire alerts in the AOI and time range.",subDistrictQuery:"There are no fire alerts for this AOI and time range."},firesLayer:{url:"http://gis-potico.wri.org/arcgis/rest/services/Fires/FIRMS_ASEAN/MapServer",id:"Active_Fires",fire_id:0,defaultLayers:[0],query:{layerId:0,outfields:["*"],fields:[{name:"LATITUDE",label:"LATITUDE"},{name:"LONGITUDE",label:"LONGITDUE"},{name:"BRIGHTNESS",label:"BRIGHTNESS"},{name:"CONFIDENCE",label:"CONFIDENCE"},{name:"ACQ_DATE",label:"ACQUISITION DATE"},{name:"ACQ_TIME",label:"ACQUISITION TIME"}]}},adminBoundary:{mapDiv:"district-fires-map",url:"http://gis-potico.wri.org/arcgis/rest/services/Fires/FIRMS_ASEAN/MapServer",id:"district-bounds",defaultLayers:[6],UniqueValueField:"DISTRICT",regionField:"PROVINCE",layerId:6,where:"fire_count > 0",classBreaksField:"fire_count",classBreaksMethod:"natural-breaks",breakCount:5,fromHex:"#fcddd1",toHex:"#930016",legendId:"legend",queryKey:"adminQuery",loaderId:"distmapload"},subdistrictBoundary:{mapDiv:"subdistrict-fires-map",url:"http://gis-potico.wri.org/arcgis/rest/services/Fires/FIRMS_ASEAN/MapServer",id:"subdistrict-bounds",defaultLayers:[5],UniqueValueField:"SUBDISTRIC",regionField:"DISTRICT",layerId:5,where:"fire_count > 0",classBreaksField:"fire_count",classBreaksMethod:"natural-breaks",breakCount:5,fromHex:"#fcddd1",toHex:"#930016",legendId:"SubDistrict-legend",queryKey:"subDistrictQuery",loaderId:"subdistmapload"},adminQuery:{outFields:["NAME_2","NAME_1","fire_count"],tableId:"district-fires-table",headerField:["DISTRICT","PROVINCE"],UniqueValueField:"DISTRICT",regionField:"PROVINCE",layerId:6,fire_stats:{id:0,outField:"fire_count",onField:"DISTRICT"}},subDistrictQuery:{outFields:["SUBDISTRIC","DISTRICT","fire_count"],tableId:"subdistrict-fires-table",UniqueValueField:"SUBDISTRIC",regionField:"DISTRICT",headerField:["SUBDISTRICT","DISTRICT"],fire_stats:{id:0,outField:"fire_count",onField:"SUBDISTRIC"},layerId:5},pulpwoodQuery:{outFields:["pulpwoodt","fire_count"],tableId:"pulpwood-fires-table",headerField:["NAME"],fire_stats:{id:0,outField:"fire_count",onField:"pulpwoodt"},layerId:5},palmoilQuery:{outFields:["palm_oilt","fire_count"],tableId:"palmoil-fires-table",headerField:["NAME"],fire_stats:{id:0,outField:"fire_count",onField:"palm_oilt"},layerId:5},loggingQuery:{outFields:["loggingt","fire_count"],tableId:"logging-fires-table",headerField:["NAME"],fire_stats:{id:0,outField:"fire_count",onField:"loggingt"},layerId:5},rspoQuery:{outFields:["palm_oil","fire_count"],tableId:"rspo-cert-table",headerField:["NAME"],groupByFieldsForStatistics:["CERT_SCHEM","palm_oil"],fire_stats:{id:0,outField:"fire_count",onField:"palm_oil"},layerId:5},queryUrl:"http://gis-potico.wri.org/arcgis/rest/services/Fires/FIRMS_ASEAN/MapServer",companyConcessionsId:1,confidenceFireId:0,dailyFiresId:8,dailyFiresField:"ACQ_DATE"};return{init:function(){var e=this,r=D.proxies,i=document.location.href,a="/proxy/proxy.ashx";for(var o in r)0===i.indexOf(o)&&(a=r[o]);e.init_report_options(),f.defaults.io.proxyUrl=a,Highcharts.setOptions({chart:{style:{fontFamily:"Arial MT Condensed Light"}}}),t(function(){s([e.buildFiresMap(),e.queryDistrictsFireCount("adminQuery").then(function(){e.buildFireCountMap("adminBoundary","adminQuery")}),e.queryDistrictsFireCount("subDistrictQuery").then(function(){e.buildFireCountMap("subdistrictBoundary","subDistrictQuery")}),e.queryDistrictsFireCount("pulpwoodQuery"),e.queryDistrictsFireCount("palmoilQuery"),e.queryDistrictsFireCount("loggingQuery"),e.queryDistrictsFireCount("rspoQuery"),e.queryForPeatFires(),e.queryForSumatraFires(),e.queryForMoratoriumFires(),e.queryForDailyFireData(),e.attachClickHandlers()]).then(function(){e.get_extent(),e.printReport()})})},init_report_options:function(){var t=this;window.reportOptions||t.read_hash();var r=window.reportOptions.dates;this.startdate=t.date_obj_to_string({year:r.fYear,month:r.fMonth,day:r.fDay}),this.enddate=t.date_obj_to_string({year:r.tYear,month:r.tMonth,day:r.tDay}),this.aoilist=window.reportOptions.aois.join(", "),this.aoitype=window.reportOptions.aoitype,e.byId("fromDate").innerHTML="From: "+t.startdate,e.byId("toDate").innerHTML="To: "+t.enddate,e.byId("aoiList").innerHTML="ON "+t.aoitype.toUpperCase()+"S: "+t.aoilist},read_hash:function(){var e,t=window.location.href,r=2==t.split("#").length&&t.split("#")[1].length>1;e=r?u.queryToObject(t.split("#")[1]):D.defaultState;var i={};e.dates.split("!").map(function(e){var t=e.split("-");i[t[0]]=t[1]}),window.reportOptions={aoitype:e.aoitype},window.reportOptions.aois=e.aois.split("!"),window.reportOptions.dates=i},date_obj_to_string:function(e){var t="";return t+=e.year+"-",t+=e.month+"-",t+=e.day},get_layer_definition:function(){var e=window.reportOptions.aois,t="ACQ_DATE >= date'"+this.startdate+"'",r="ACQ_DATE <= date'"+this.enddate+"'",i=window.reportOptions.aoitype+" in ('";i+=e.join("','"),i+="')";var a=[i,t,r,"BRIGHTNESS >= 330","CONFIDENCE >= 30"].join(" AND ");return a},get_aoi_definition:function(){var e=window.reportOptions.aois,t=window.reportOptions.aoitype+" in ('";return t+=e.join("','"),t+="')"},buildFiresMap:function(){var t,r,a,o=this,n=new i;return a=new d("simple-fires-map",{basemap:R.basemap,zoom:R.zoom,center:R.mapcenter,slider:R.slider}),a.on("update-start",function(){esri.show(e.byId("firesmapload"))}),a.on("update-end",function(){esri.hide(e.byId("firesmapload"))}),R.maps.fires=a,t=new p,t.format="png32",t.layerIds=R.firesLayer.defaultLayers,t.layerOption=p.LAYER_OPTION_SHOW,r=new y(R.firesLayer.url,{imageParameters:t,id:R.firesLayer.id,visible:!0}),r.setLayerDefinitions([o.get_layer_definition()]),a.addLayer(r),r.on("load",function(){n.resolve(!0)}),mp=a,n.promise},buildFireCountMap:function(t,r){function a(){for(var r="<table>",i=0;i<R[t].breakCount;i++){var a=S[i];if(a){var o=1>i?D[i]:D[i]+1;r+="<tr><td class='legend-swatch' style='background-color: rgb("+a.color.r+","+a.color.g+","+a.color.b+");'></td>",r+="<td class='legend-label'>"+o+" - "+D[i+1]+"</td></tr>"}}r+="</table>",e.byId(g.legendId).innerHTML=r}function o(){a(),c=new I,c.renderer=u,m[g.layerId]=c;var e=[];e[g.layerId]=g.UniqueValueField+" in ('"+_.join("','")+"')",s.setLayerDefinitions(e),s.setLayerDrawingOptions(m),s.on("update-end",function(){h.resolve(!0)})}var n,s,u,c,f,h=new i,g=R[t],m=[],w=R.query_results[r];if(0!=w.length){var v=w.map(function(e){return e.attributes.fire_count}).sort(function(e,t){return e-t});sar=v;var _=w.map(function(e){return null!=e.attributes[g.UniqueValueField]?e.attributes[g.UniqueValueField].replace("'","''"):void 0}).filter(function(e){return null!=e?e:void 0}),C=function(e,t,r){var i;A(),setSerie(v),v.length<g.breakCount&&(g.breakCount=v.length-1);var a=g.breakCount;switch(r){case"natural":i=getClassJenks(g.breakCount);break;case"equal":i=getClassEqInterval(g.breakCount);break;case"quantile":i=getClassQuantile(g.breakCount);break;case"stddev":i=getClassStdDeviation(nbClass);break;case"arithmetic":i=getClassArithmeticProgression(nbClass);break;case"geometric":i=getClassGeometricProgression(nbClass);break;default:i=getClassJenks(g.breakCount)}for(var o={},n=0;a>n;n+=1){var s=new b,u=R.colorramp[n];s.setColor({a:255,r:u[0],g:u[1],b:u[2]}),o[n]=s}var d=new b;d.setColor({a:255,r:255,g:255,b:255});var c=new F(d,g.UniqueValueField);return l.forEach(e,function(e){for(var t,r=e.attributes.fire_count,a=0;a<i.length;a++)if(r<=i[a+1]){t=o[a];break}void 0==t&&console.log("UNDEFINED",e),c.addValue({value:e.attributes[g.UniqueValueField],symbol:t})}),{r:c,s:o,b:i}},T=C(w,_,"natural"),u=T.r,S=T.s,D=T.b;return f=new d(g.mapDiv,{basemap:R.basemap,zoom:R.zoom,center:R.mapcenter,slider:R.slider}),R.maps[t]=f,n=new p,n.format="png32",n.layerIds=g.defaultLayers,n.layerOption=p.LAYER_OPTION_SHOW,s=new y(g.url,{imageParameters:n,id:g.id,visible:!0}),s.on("load",o),f.addLayer(s),f.on("update-start",function(){esri.show(e.byId(g.loaderId))}),f.on("update-end",function(){esri.hide(e.byId(g.loaderId))}),h.promise}},buildOtherFiresMap:function(t){function r(t){var r="<table>";l.forEach(t,function(e){r+="<tr><td class='legend-swatch' style='background-color: rgb("+e.symbol.color.r+","+e.symbol.color.g+","+e.symbol.color.b+");'></td>",r+="<td class='legend-label'>"+e.minValue+" - "+e.maxValue+"</td></tr>"}),r+="</table>",e.byId(T.legendId).innerHTML=r}function a(){F=new w(T.url+"/"+T.layerId),F.execute(s,function(e){r(e.infos),v=new I,v.renderer=e,S[T.layerId]=v,n.setLayerDrawingOptions(S),n.on("update-end",function(){C.resolve(!0)})},function(){C.resolve(!1)})}var o,n,s,u,f,F,v,_,C=new i,T=R[t],S=[];return _=new d(T.mapDiv,{basemap:R.basemap,zoom:R.zoom,center:R.mapcenter,slider:R.slider}),o=new p,o.format="png32",o.layerIds=T.defaultLayers,o.layerOption=p.LAYER_OPTION_SHOW,n=new y(T.url,{imageParameters:o,id:T.id,visible:!0}),f=new g,f.classificationField=T.classBreaksField,f.classificationMethod=T.classBreaksMethod,f.breakCount=T.breakCount,f.baseSymbol=new b,u=new h,u.fromColor=c.fromHex(T.fromHex),u.toColor=c.fromHex(T.toHex),u.algorithm="cie-lab",f.colorRamp=u,s=new m,s.classificationDefinition=f,s.where=T.where,n.on("load",a),_.addLayer(n),_.on("load",function(){_.disableMapNavigation()}),C.promise},getRegion:function(e){var t=R[e],r=new _(R.queryUrl+"/"+t.layerId),a=window.reportOptions.aoitype,o=new i,n=new v,s={},u=this;return n.where=u.get_aoi_definition(),n.returnGeometry=!1,n.outFields=[a,t.UniqueValueField],r.execute(n,function(r){r.features.length>0&&(l.forEach(r.features,function(e){s[e.attributes[t.UniqueValueField]]=e.attributes[a]}),R.regionmap[e]=s,o.resolve(!0))},function(){o.resolve(!1)}),o.promise},queryDistrictsFireCount:function(t){function r(e){var r="<table class='fires-table'><tr>";r+="<th>CONCESSION TYPE</th>",r+="<th>NUMBER OF FIRE ALERTS</th></tr>";var i=0,a=0;l.map(e,function(e){"1"===e.attributes.palm_oil&&(a+=e.attributes.fire_count,"RSPO"===e.attributes.CERT_SCHEM&&(i+=e.attributes.fire_count))});var o=[{attributes:{type:"RSPO CERTIFIED PALM OIL CONCESSIONS",fire_count:i}},{attributes:{type:"ALL PALM OIL CONCESSIONS",fire_count:a}}];r+=f.generateTableRows(o,["type","fire_count"]),r+="</table>";var n=o.length>0?r:'<div class="noFiresTable">'+R.noFeatures[t]+"</div>";return n}function a(e){var r="<table class='fires-table'><tr><th>"+o.headerField[0]+"</th>";o.headerField.length>1?r+="<th>"+window.reportOptions.aoitype.toUpperCase()+"</th>":s=[s[0],s[2]];var i=l.filter(e,function(e){return 0!==e.attributes.fire_count});r+="<th>NUMBER OF FIRE ALERTS</th></tr>",r+=f.generateTableRows(i,s),r+="</table>";var a=i.length>0?r:'<div class="noFiresTable">'+R.noFeatures[t]+"</div>";return a}var o=R[t],n=new _(R.queryUrl+"/"+o.fire_stats.id),s=[o.fire_stats.onField,window.reportOptions.aoitype,o.fire_stats.outField],u=new i,d=new v,c=new C,f=this;return d.where=f.get_layer_definition(),d.returnGeometry=!1,d.outFields=[o.fire_stats.onField],d.orderByFields=["fire_count DESC"],d.groupByFieldsForStatistics=[d.outFields[0]],o.groupByFieldsForStatistics&&(d.groupByFieldsForStatistics=o.groupByFieldsForStatistics),c.onStatisticField=o.fire_stats.onField,c.outStatisticFieldName=o.fire_stats.outField,c.statisticType="count",d.outStatistics=[c],n.execute(d,function(i){R.query_results[t]=i.features,i.features.length>0?(o.UniqueValueField?f.getRegion(t).then(function(){var r=R.regionmap[t];l.forEach(i.features,function(e){e.attributes[window.reportOptions.aoitype]=r[e.attributes[o.UniqueValueField]]}),e.byId(o.tableId).innerHTML=a(i.features.slice(0,10))}):e.byId(o.tableId).innerHTML="rspoQuery"==t?r(i.features):a(i.features.slice(0,10)),u.resolve(!0)):(u.resolve(!1),e.byId("noFiresMsg").innerHTML="No Fire Alerts for this AOI and time frame.")},function(){u.resolve(!1)}),u.promise},queryDistrictsForFires:function(t){function r(e){var t="<table class='fires-table'><tr><th>"+a.headerField[0]+"</th><th>"+a.headerField[1]+"</th><th>NUMBER OF FIRE ALERTS</th></tr>";return t+=u.generateTableRows(e,n),t+="</table>"}var a=R[t],o=new _(R.queryUrl+"/"+a.layerId),n=a.outFields,s=new i,l=new v,u=this;return l.where=u.get_layer_definition(),l.returnGeometry=!1,l.outFields=n,l.orderByFields=["fire_count DESC"],o.execute(l,function(t){t.features.length>0&&(e.byId(a.tableId).innerHTML=r(t.features.slice(0,10)),s.resolve(!0))},function(){s.resolve(!1)}),s.promise},queryCompanyConcessions:function(){function t(t,r,i){var a="<table class='fires-table'><tr><th>NAME</th><th>NUMBER OF FIRE ALERTS</th></tr>",n=a+p.generateTableRows(t,o.slice(0,2))+"</table>",s=a+p.generateTableRows(r,o.slice(0,2))+"</table>",l=a+p.generateTableRows(i,o.slice(0,2))+"</table>",u="There are no fire alerts in pulpwood concessions in the last 7 days.",d="There are no fire alerts in palm oil concessions in the last 7 days.",c="There are no fire alerts in logging concessions in the last 7 days.";e.byId("pulpwood-fires-table").innerHTML=t.length>0?n:'<div class="noFiresTable">'+u+"</div>",e.byId("palmoil-fires-table").innerHTML=r.length>0?s:'<div class="noFiresTable">'+d+"</div>",e.byId("logging-fires-table").innerHTML=i.length>0?l:'<div class="noFiresTable">'+c+"</div>"}var r,a=new _(R.queryUrl+"/"+R.companyConcessionsId),o=["Name","fire_count","TYPE"],n=new i,s=new v,u=new Date,d=[],c=[],f=[],p=this;return u=new Date(u.getFullYear(),u.getMonth(),u.getDate()-7),dateString=u.getFullYear()+"-"+(u.getMonth()+1)+"-"+(u.getDate()-7)+" "+u.getHours()+":"+u.getMinutes()+":"+u.getSeconds(),s.where="fire_count IS NOT NULL",s.returnGeometry=!1,s.outFields=o,s.orderByFields=["fire_count DESC"],a.execute(s,function(e){l.every(e.features,function(e){return r=e.attributes.TYPE,"Oil palm concession"===r&&f.length<10?f.push(e):"Wood fiber plantation"===r&&d.length<10?d.push(e):"Logging concession"===r&&c.length<10&&c.push(e),!(f.length>9&&d.length>9&&c.length>9)}),f=l.filter(f,function(e){return 0!==e.attributes.fire_count}),d=l.filter(d,function(e){return 0!==e.attributes.fire_count}),c=l.filter(c,function(e){return 0!==e.attributes.fire_count}),t(d,f,c),n.resolve(!0)},function(){n.resolve(!1)}),n.promise},queryForPeatFires:function(){var e,t,r,a=new i,o=[],n=this,s=function(i){t=i.features.length,e=0,r=0,l.forEach(i.features,function(t){1===t.attributes.peat?r++:e++}),o.push({color:"rgba(184,0,18,1)",name:"Peat",visible:!0,y:r}),o.push({color:"rgba(17,139,187,1)",name:"Non-peat",visible:!0,y:e}),n.buildPieChart("peat-fires-chart",{data:o,name:"Peat Fires",labelDistance:-25,total:t}),a.resolve(!0)},u=function(){a.resolve(!1)};return n.queryFireData({outFields:["peat"]},s,u),a.promise},queryForMoratoriumFires:function(){function e(e){o=e.features.length,a=0,r=0,l.forEach(e.features,function(e){1===e.attributes.moratorium?a++:r++}),s.push({color:"rgba(184,0,18,1)",name:"In Indicative Moratorium Areas",visible:!0,y:a}),s.push({color:"rgba(17,139,187,1)",name:"Not in Indicative Moratorium Areas",visible:!0,y:r}),u.buildPieChart("moratorium-fires-chart",{data:s,name:"Moratorium Fires",labelDistance:-25,total:o}),n.resolve(!0)}function t(e){n.resolve(!1),console.error(e)}var r,a,o,n=new i,s=[],u=this;return u.queryFireData({outFields:["moratorium"]},e,t),n.promise},queryForSumatraFires:function(){var e,t,r,a,o,n,s,u,d=new i,c=[],f=[],p=this;return n=function(i){u=i.features.length,e=0,t=0,r=0,a=0,o=0,l.forEach(i.features,function(i){1===i.attributes.wdpa?e++:t++,"1"===i.attributes.logging&&o++,"1"===i.attributes.palm_oil&&a++,"1"===i.attributes.pulpwood&&r++}),c.push({color:"rgba(184,0,18,1)",name:"In Protected Areas",visible:!0,y:e}),c.push({color:"rgba(17,139,187,1)",name:"Outside Protected Areas",visible:!0,y:t}),p.buildPieChart("protected-areas-fires-chart",{data:c,name:"Protected Area Fires",labelDistance:-30,total:u}),f.push({color:"rgba(17,139,187,1)",name:"Pulpwood Plantations",visible:!0,y:r}),f.push({color:"rgba(184,0,18,1)",name:"Palm Oil Concessions",visible:!0,y:a}),f.push({color:"rgba(106,0,78,1)",name:"Logging Concessions",visible:!0,y:o}),f.push({color:"rgba(233,153,39,1)",name:"Outside Concessions",visible:!0,y:u-(o+a+r)}),p.buildPieChart("land-use-fires-chart",{data:f,name:"Fires in Concessions",labelDistance:30,total:u}),d.resolve(!0)},s=function(){d.resolve(!1)},p.queryFireData({outFields:["wdpa","pulpwood","palm_oil","logging"]},n,s),d.promise},queryForDailyFireData:function(){var e,t,r=new _(R.queryUrl+"/"+R.firesLayer.fire_id),a=new i,o=new v,n=[],s=[],u=this,d=new C;return o.where=[u.get_aoi_definition(),"BRIGHTNESS >= 330","CONFIDENCE >= 30"].join(" AND "),o.returnGeometry=!1,o.groupByFieldsForStatistics=[R.dailyFiresField],o.orderByFields=["ACQ_DATE ASC"],d.onStatisticField=R.dailyFiresField,d.outStatisticFieldName="Count",d.statisticType="count",o.outStatistics=[d],e=function(e){l.forEach(e.features,function(e){n.push(moment(e.attributes[R.dailyFiresField]).tz("Asia/Jakarta").format("M/D/YYYY")),s.push(e.attributes.Count)}),$("#fire-line-chart").highcharts({chart:{zoomType:"x"},title:{text:null},subtitle:{text:void 0===document.ontouchstart?"Click and drag in the plot area to zoom in":"Pinch the chart to zoom in"},plotOptions:{line:{marker:{enabled:!1}}},xAxis:{categories:n,type:"datetime",minTickInterval:20,minRange:30,labels:{rotation:-45}},yAxis:{min:0,title:{text:null},plotLines:[{value:0,width:1,color:"#a90016"}]},tooltip:{valueSuffix:""},credits:{enabled:!1},legend:{enabled:!1},series:[{name:"Daily Fires",data:s,color:"#f49f2d"}]})},t=function(e){console.dir(e)},r.execute(o,e,t),a.resolve(!0),a.promise},attachClickHandlers:function(){r(e.byId("high-confidence-info-report"),"click",function(){$("html, body").animate({scrollTop:$(document).height()},"slow")}),r(e.byId("confidence-footnote"),"click",function(){$("html, body").animate({scrollTop:$(document).height()},"slow")})},queryFireData:function(e,t,r){var a,o=new _(R.queryUrl+"/"+R.confidenceFireId),n=(new i,new v),s=new Date,l=this;s=new Date(s.getFullYear(),s.getMonth(),s.getDate()-8),a=s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+" "+s.getHours()+":"+s.getMinutes()+":"+s.getSeconds();var u=l.get_layer_definition();n.where=void 0===e.where?u:u+" AND "+e.where,n.returnGeometry=e.returnGeometry||!1,n.outFields=e.outFields||["*"],o.execute(n,t,r)},buildPieChart:function(e,t){$("#"+e).highcharts({chart:{type:"pie"},title:{text:null},yAxis:{title:{text:null}},plotOptions:{pie:{shadow:!1,center:["50%","50%"],showInLegend:!0,dataLabels:{fontSize:"22px"}}},tooltip:{formatter:function(){return Math.round(this.y/t.total*100)+"% ("+this.y+" fires)"}},credits:{enabled:!1},legend:{layout:"vertical"},series:[{name:t.name,data:t.data,size:"80%",innerSize:"50%",dataLabels:{distance:t.labelDistance,color:"black",formatter:function(){return Math.round(this.y/t.total*100)+"%"}}}]})},get_extent:function(){var e,t=new _(R.queryUrl+"/"+R.adminQuery.layerId),r=new i,a=new v,o=(new Date,this);return e=["fires","adminBoundary","subdistrictBoundary"],a.where=o.get_aoi_definition(),a.returnGeometry=!0,a.outFields=["DISTRICT"],callback=function(t){var i=T.graphicsExtent(t.features);l.forEach(e,function(e){var t=R.maps[e];t.setExtent(i,!0)}),r.resolve(!0)},errback=function(e){console.log(e)},t.execute(a,callback,errback),r.promise},generateRSPOtableRows:function(){},generateTableRows:function(e,t){function r(e){return null!==e&&void 0!==e&&!a.test(e)}var i="",a=/^\s+$/;return l.forEach(e,function(e){var a=!0,o="";l.forEach(t,function(t){r(e.attributes[t])?o+="<td>"+(r(e.attributes[t])?e.attributes[t]:" - ")+"</td>":a=!1}),a&&(i+="<tr>",i+=o,i+="</tr>")}),i},printReport:function(){}}});
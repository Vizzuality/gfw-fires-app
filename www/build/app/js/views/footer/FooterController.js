define(["dojo/query","dojo/dom","dojo/dom-class","dojo/Deferred","dojo/topic","dijit/registry","modules/HashController","modules/EventsController","views/footer/FooterModel","views/map/MapConfig","main/Config","dojo/_base/array","esri/tasks/query","esri/tasks/QueryTask","esri/request"],function(dojoQuery,dom,domClass,Deferred,topic,registry,HashController,EventsController,FooterModel,MapConfig,MainConfig,arrayUtil,Query,QueryTask,esriRequest){var o={},initialized=!1,viewId="app-footer",gfwFooterLoaded=!1;return o.init=function(){var e=this;initialized||(initialized=!0,require(["dojo/text!views/footer/footer.html","views/footer/FooterModel"],function(t,r){dom.byId(viewId).innerHTML=t+dom.byId(viewId).innerHTML,r.applyBindings(viewId),e.initShareButton();var o=document.createElement("script"),i=document.getElementsByTagName("head")[0];o.src="https://cdn.rawgit.com/simbiotica/gfw_assets/c821fe8f7c5dc545d78be491074621/js/build/production.js",o.async=!0,o.setAttribute("id","loader-gfw"),o.setAttribute("data-current",".shape-fires"),i.appendChild(o)}))},o.initShareButton=function(){!function(e,t,r){var o,i=e.getElementsByTagName(t)[0];e.getElementById(r)||(o=e.createElement(t),o.id=r,o.src="https://platform.twitter.com/widgets.js",i.parentNode.insertBefore(o,i))}(document,"script","twitter-wjs"),function(e,t,r){var o,i=e.getElementsByTagName(t)[0];e.getElementById(r)||(o=e.createElement(t),o.id=r,o.src="//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v2.0",i.parentNode.insertBefore(o,i))}(document,"script","facebook-jssdk")},o.footerSelect=function(data){var selectedItem=data;eval("EventsController."+selectedItem.eventName+"()")},o.subscribeToAlerts=function(){require(["dojo/on","dijit/Dialog","dojo/dom-construct"],function(e,t,r){function o(){r.destroy(dom.byId("signUpAlertsForm")),i.remove()}var i,n=new t({title:"Sign up to receive fire alerts!",style:"width: 350px;height: auto;"});n.setContent(MainConfig.alertsSignUpContent),n.show(),i=e(dom.byId("map-link-from-signup"),"click",function(){EventsController.clickNavLink({html:"Map",viewName:"map",domId:"mapView",selected:!1}),n.destroy(),o()}),n.on("cancel",o)})},o.postSubscribeRequest=function(e,t,r){var o,i=MainConfig.emailSubscribeUrl,n={areas:JSON.stringify(e),msg_addr:t,msg_type:r},s=dom.byId("verifyEmailForAlerts").value,a=new Deferred;return""===s?(dom.byId("alerts-submit-button").innerHTML="Submitting...",o=esriRequest({url:i,content:n,handleAs:"json"},{usePost:!0}),o.then(function(){dom.byId("alerts-submit-button").innerHTML="Submit",alert("You have successfully subscribed, you should start receiving alerts as they come in for your area(s) of interest."),a.resolve(!0)},function(e){dom.byId("alerts-submit-button").innerHTML="Submit",alert("There was an error subcribing at this time. "+e.message),a.resolve(!1)})):a.resolve(!0),a.promise},o.getProvinceValues=function(){var e,t,r=new Deferred,o=new QueryTask(MapConfig.layerForProvinceQuery.url),i=new Query,n=[],s=[];return i.returnGeometry=!1,i.outFields=MapConfig.layerForProvinceQuery.outFields,i.where="1 = 1",o.execute(i,function(o){arrayUtil.forEach(o.features,function(r){t=r.attributes,e=t[MapConfig.layerForProvinceQuery.outFields[0]],-1===arrayUtil.indexOf(s,e)&&(s.push(e),n.push({label:e,value:e}))}),n.sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0}),n.unshift({label:"Choose one",value:"NONE",selected:!0}),r.resolve(n)},function(){r.resolve(!1)}),r.promise},o.getDistrictValues=function(){var e,t,r,o=new Deferred,i=new QueryTask(MapConfig.layerForDistrictQuery.url),n=new Query,s=[],a=[];return FooterModel.get("districtsAvailableForAlerts").length>0?o.resolve(!1):(n.returnGeometry=!1,n.outFields=MapConfig.layerForDistrictQuery.outFields,n.where="1 = 1",i.execute(n,function(i){arrayUtil.forEach(i.features,function(o){r=o.attributes,e=r[MapConfig.layerForDistrictQuery.outFields[0]],t=r[MapConfig.layerForDistrictQuery.outFields[1].toUpperCase()],-1===arrayUtil.indexOf(a,e)&&(a.push(e),s.push({label:e,value:e,province:t}))}),s.sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0}),s.unshift({label:"Choose one",value:"NONE",selected:!0}),o.resolve(s)},function(){o.resolve(!1)})),o.promise},o.getSubDistricts=function(e){var t,r,o=new Deferred,i=new QueryTask(MapConfig.layerForSubDistrictQuery.url),n=new Query,s=[],a=[];n.returnGeometry=!1,n.outFields=MapConfig.layerForSubDistrictQuery.outFields;var l;if("ALL"===e[0].value)console.log("ALL"),l="1 = 1";else for(var l="DISTRICT = '",u=0;u<e.length;u++)l+=e[u].value,l+=u==e.length-1?"'":"' OR DISTRICT = '";return n.where=l,i.execute(n,function(e){arrayUtil.forEach(e.features,function(e){t=e.attributes,r=t[MapConfig.layerForSubDistrictQuery.outFields[1]],-1===arrayUtil.indexOf(a,r)&&(a.push(r),s.push({label:t[MapConfig.layerForSubDistrictQuery.outFields[0]],value:r}))}),s.sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0}),o.resolve(s)},function(){o.resolve(!1)}),o.promise},o});
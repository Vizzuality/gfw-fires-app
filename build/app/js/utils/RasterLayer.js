define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/array","dojo/dom-construct","dojo/dom-style","dojo/number","esri/lang","esri/domUtils","esri/SpatialReference","esri/geometry/Point","esri/layers/layer"],function(t,e,n,i,s,h,o,a,c,r,_){var l=t([_],{"-chains-":{constructor:"manual"},constructor:function(t,e){this.inherited(arguments,["http://some.server.com/path",e]),this.data=t,this.loaded=!0,this.onLoad(this)},_setMap:function(t,n){this._map=t;var h=this._element=i.create("canvas",{id:"canvas",width:t.width+"px",height:t.height+"px",style:"position: absolute; left: 0px; top: 0px;"},n);return o.isDefined(this.opacity)&&s.set(h,"opacity",this.opacity),this._context=h.getContext("2d"),this._context||console.error("This browser does not support <canvas> elements."),this._mapWidth=t.width,this._mapHeight=t.height,this._connects=[],this._connects.push(e.connect(t,"onPan",this,this._panHandler)),this._connects.push(e.connect(t,"onExtentChange",this,this._extentChangeHandler)),this._connects.push(e.connect(t,"onZoomStart",this,this.clear)),this._connects.push(e.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler)),h},_unsetMap:function(t,i){n.forEach(this._connects,e.disconnect,this),this._element&&i.removeChild(this._element),this._map=this._element=this._context=this.data=this._connects=null},refresh:function(){!this._canDraw()},clear:function(){this._canDraw()&&this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},_canDraw:function(){return this._map&&this._element&&this._context?!0:!1},_panHandler:function(t,e){s.set(this._element,{left:e.x+"px",top:e.y+"px"})},_extentChangeHandler:function(t,e,n){n||(s.set(this._element,{left:"0px",top:"0px"}),this.clear())},_visibilityChangeHandler:function(t){t?a.show(this._element):a.hide(this._element)}});return l});
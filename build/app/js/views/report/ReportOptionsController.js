/*! Global-Forest-Watch-Fires Fri Dec 12 2014 09:16:49 */
define(["dojo/on","dojo/dom","esri/tasks/query","esri/tasks/QueryTask","views/map/MapConfig","views/map/MapModel","dojo/_base/array"],function(on,dom,Query,QueryTask,MapConfig,MapModel,arrayUtil){var o={};return o.queryDistinct=function(a,b,c){var d=new Query;d.returnGeometry=!1,d.where="1=1",d.outFields=[b],d.returnDistinctValues=!0;var e=new QueryTask(a);e.execute(d,c)},o.populatecallback=function(){},o.init_time_selects=function(){var a=new Date,b=new Date;b.setDate(a.getDate()-7);for(var c=new Date(2013,1,1),d=[],e=c.getFullYear();e<=a.getFullYear();e++)d.push(e)},o.bind_events=function(){var a;on(dom.byId("report-island-radio"),"change",function(){var a=MapModel.vm.islands();MapModel.vm.reportAOIs([]),arrayUtil.forEach(a,function(a){MapModel.vm.reportAOIs.push(a)}),MapModel.vm.selectedAOIs(["Sumatra"])}),on(dom.byId("report-province-radio"),"change",function(){var a=MapModel.vm.provinces();MapModel.vm.reportAOIs([]),arrayUtil.forEach(a,function(a){MapModel.vm.reportAOIs.push(a)}),MapModel.vm.selectedAOIs(["Riau"])}),on(dom.byId("report-launch"),"click",function(){dom.byId("report-province-radio").checked?a="PROVINCE":dom.byId("report-island-radio").checked&&(a="ISLAND");var b=MapModel.vm.firesObservFrom().split("/"),c=MapModel.vm.firesObservTo().split("/"),d={};d.fYear=Number(b[2]),d.fMonth=Number(b[0]),d.fDay=Number(b[1]),d.tYear=Number(c[2]),d.tMonth=Number(c[0]),d.tDay=Number(c[1]);var e=o.report_data_to_hash(a,d,MapModel.vm.selectedAOIs),f=window.open("./app/js/views/report/report.html"+e,"Report","");f.report=!0,f.reportOptions={dates:d,aois:MapModel.vm.selectedAOIs(),aoitype:a}})},o.report_data_to_hash=function(a,b,c){var d,e,f="#",g=[];for(var h in b)b.hasOwnProperty(h)&&g.push([h,b[h]].join("-"));return d="dates="+g.join("!"),e="aois="+c().join("!"),f+=["aoitype="+a,d,e].join("&"),console.log("HASH STING",f),f},o.populate_select=function(){var a=this,b=MapConfig.firesLayer;a.bind_events(),selaois=MapModel.vm.selectedAOIs;var c=function(a){var b=[];arrayUtil.forEach(a.features,function(a){""!=a.attributes.ISLAND&&b.push(a.attributes.ISLAND)}),MapModel.vm.islands(b.sort()),MapModel.vm.reportAOIs(b),MapModel.vm.selectedAOIs(["Sumatra","Kalimantan","Lesser Sunda","Maluku","Papua","Sulawesi","Java"])},d=function(a){var b=[];arrayUtil.forEach(a.features,function(a){""!=a.attributes.PROVINCE&&b.push(a.attributes.PROVINCE)}),MapModel.vm.provinces(b.sort())},e="http://gis-potico.wri.org/arcgis/rest/services/Fires/FIRMS_ASEAN/MapServer/7";a.queryDistinct(e+"?returnDistinctValues=true",b.report_fields.islands,c),a.queryDistinct(e+"?returnDistinctValues=true",b.report_fields.provinces,d)},o.query=function(props){var layer=props.layer,where=props.where||"1=1",returnGeometry=props.returnGeometry||!1,outFields=props.outFields||["*"],type=props.type||"execute",queryTask=new QueryTask(layer),query=new Query;query.where=where,query.returnGeometry=returnGeometry,query.outFields=outFields,query.getCount;var deferred=eval("queryTask."+type+"(query)");return deferred},o});
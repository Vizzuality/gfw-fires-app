define(["dojo/on","dojo/dom","esri/tasks/query","esri/tasks/QueryTask","views/map/MapConfig","views/map/MapModel","dojo/_base/array"],function(on,dom,Query,QueryTask,MapConfig,MapModel,arrayUtil){var o={};return o.queryDistinct=function(e,r,t){var o=new Query;o.returnGeometry=!1,o.where="1=1",o.outFields=[r],o.returnDistinctValues=!0;var a=new QueryTask(e);a.execute(o,t)},o.populatecallback=function(){},o.init_time_selects=function(){var e=new Date,r=new Date;r.setDate(e.getDate()-7);for(var t=new Date(2013,1,1),o=[],a=t.getFullYear();a<=e.getFullYear();a++)o.push(a)},o.bind_events=function(){var e;on(dom.byId("report-island-radio"),"change",function(){var e=MapModel.vm.islands();MapModel.vm.reportAOIs([]),arrayUtil.forEach(e,function(e){MapModel.vm.reportAOIs.push(e)}),MapModel.vm.selectedAOIs(["Sumatra"])}),on(dom.byId("report-province-radio"),"change",function(){var e=MapModel.vm.provinces();MapModel.vm.reportAOIs([]),arrayUtil.forEach(e,function(e){MapModel.vm.reportAOIs.push(e)}),MapModel.vm.selectedAOIs(["Riau"])}),on(dom.byId("report-launch"),"click",function(){dom.byId("report-province-radio").checked?e="PROVINCE":dom.byId("report-island-radio").checked&&(e="ISLAND");var r=MapModel.vm.firesObservFrom().split("/"),t=MapModel.vm.firesObservTo().split("/"),a={};a.fYear=Number(r[2]),a.fMonth=Number(r[0]),a.fDay=Number(r[1]),a.tYear=Number(t[2]),a.tMonth=Number(t[0]),a.tDay=Number(t[1]);var s=o.report_data_to_hash(e,a,MapModel.vm.selectedAOIs),i=window.open("./app/js/views/report/report.html"+s,"Report","");i.report=!0,i.reportOptions={dates:a,aois:MapModel.vm.selectedAOIs(),aoitype:e}})},o.report_data_to_hash=function(e,r,t){var o,a,s="#",i=[];for(var n in r)r.hasOwnProperty(n)&&i.push([n,r[n]].join("-"));return o="dates="+i.join("!"),a="aois="+t().join("!"),s+=["aoitype="+e,o,a].join("&"),console.log("HASH STING",s),s},o.populate_select=function(){var e=this,r=MapConfig.firesLayer;e.bind_events(),selaois=MapModel.vm.selectedAOIs;var t=function(e){var r=[];arrayUtil.forEach(e.features,function(e){""!=e.attributes.ISLAND&&r.push(e.attributes.ISLAND)}),MapModel.vm.islands(r.sort()),MapModel.vm.reportAOIs(r),MapModel.vm.selectedAOIs(["Sumatra","Kalimantan","Lesser Sunda","Maluku","Papua","Sulawesi","Java"])},o=function(e){var r=[];arrayUtil.forEach(e.features,function(e){""!=e.attributes.PROVINCE&&r.push(e.attributes.PROVINCE)}),MapModel.vm.provinces(r.sort())},a="http://gis-potico.wri.org/arcgis/rest/services/Fires/FIRMS_ASEAN/MapServer/7";e.queryDistinct(a+"?returnDistinctValues=true",r.report_fields.islands,t),e.queryDistinct(a+"?returnDistinctValues=true",r.report_fields.provinces,o)},o.query=function(props){var layer=props.layer,where=props.where||"1=1",returnGeometry=props.returnGeometry||!1,outFields=props.outFields||["*"],type=props.type||"execute",queryTask=new QueryTask(layer),query=new Query;query.where=where,query.returnGeometry=returnGeometry,query.outFields=outFields,query.getCount;var deferred=eval("queryTask."+type+"(query)");return deferred},o});
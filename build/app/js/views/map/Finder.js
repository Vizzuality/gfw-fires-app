define(["dojo/dom","dojo/_base/array","dojo/on","esri/graphic","esri/geometry/Point","esri/geometry/webMercatorUtils","esri/symbols/PictureMarkerSymbol","views/map/MapConfig","views/map/MapModel","esri/tasks/IdentifyTask","esri/tasks/IdentifyParameters"],function(t,e,r,a,n,i,s,o,d,u,c){var l;return{setMap:function(t){l=t},searchAreaByCoordinates:function(){var r,o,u,c,f={},y=!1,p="You did not enter a valid value.  Please check that your location values are all filled in and nubmers only.",b=new s("app/images/RedStickPin.png",32,32),m={},v=function(t){return y||(y=isNaN(parseInt(t))),isNaN(parseInt(t))?0:parseInt(t)},L=function(){var t=0;return e.forEach(l.graphics.graphics,function(e){e.attribtues&&e.attributes.locatorValue&&(t=Math.max(t,parseInt(e.attributes.locatorValue)))}),t};d.get("showDMSInputs")?(f.dlat=v(t.byId("degreesLatInput").value),f.mlat=v(t.byId("minutesLatInput").value),f.slat=v(t.byId("secondsLatInput").value),f.dlon=v(t.byId("degreesLonInput").value),f.mlon=v(t.byId("minutesLonInput").value),f.slon=v(t.byId("secondsLonInput").value),r=f.dlat+f.mlat/60+f.slat/3600,o=f.dlon+f.mlon/60+f.slon/3600):(r=v(t.byId("latitudeInput").value),o=v(t.byId("longitudeInput").value)),y?alert(p):(u=i.geographicToWebMercator(new n(o,r)),m.locatorValue=L(),m.id="LOCATOR_"+m.locatorValue,c=new a(u,b,m),l.graphics.add(c),l.centerAndZoom(u,7),d.set("showClearPinsOption",!0))},fetchTwitterData:function(t){var e=t.target?t.target:t.srcElement;!e.checked},mapClick:function(a){var n=l;if(forestUseLayer=n.getLayer(o.forestUseLayers.id),conservationLayers=n.getLayer(o.conservationLayers.id),visLayers=[],isVisLayers=forestUseLayer.visibleLayers.indexOf(10)>-1||conservationLayers.visible||forestUseLayer.visibleLayers.indexOf(26)>-1||forestUseLayer.visibleLayers.indexOf(27)>-1||forestUseLayer.visibleLayers.indexOf(28)>-1||forestUseLayer.visibleLayers.indexOf(32)>-1,visible=forestUseLayer.visible,e.forEach(forestUseLayer.visibleLayers,function(t){visLayers.push(t)}),conservationLayers.visible&&visLayers.push(25),Array.prototype.move=function(t,e){this.splice(e,0,this.splice(t,1)[0])},visLayers.move(visLayers.indexOf(27),0),isVisLayers){var i=new u(forestUseLayer.url);identifyParams=new c,identifyParams.tolerance=3,identifyParams.returnGeometry=!0,identifyParams.layerIds=visLayers,identifyParams.width=n.width,identifyParams.height=n.height,identifyParams.geometry=a.mapPoint,identifyParams.mapExtent=n.extent,i.execute(identifyParams,function(e){var i=e[0];i&&(content="<div id='closePopup' class='close-icon'></div><table id='infoWindowTable'>",25==i.layerId?(content+="<tr class='infoName'><td colspan='2'>"+i.feature.attributes.NAME+"</td></tr>",content+="<tr><td>Local Name</td><td>"+i.feature.attributes.ORIG_NAME+"</td></tr>",content+="<tr><td>Legal Designation</td><td>"+i.feature.attributes.DESIG_ENG+"</td></tr>",content+="<tr><td>WDPA ID</td><td>"+i.feature.attributes.WDPAID+"</td></tr>"):27==i.layerId?(content+="<tr class='infoName'><td colspan='2'>"+i.feature.attributes.NAME+"</td></tr>",content+="<tr><td>Concession Type</td><td>"+i.feature.attributes.TYPE+"</td></tr>",content+="<tr><td>Country</td><td>"+i.feature.attributes.Country+"</td></tr>",content+="<tr><td>Group</td><td>"+i.feature.attributes.GROUP_NAME+"</td></tr>",content+="<tr><td>Certification Status</td><td>"+i.feature.attributes.CERT_STAT+"</td></tr>",content+="<tr><td>GIS Calculated Area (ha)</td><td>"+i.feature.attributes.AREA_HA+"</td></tr>",content+="<tr><td>Certificate ID</td><td>"+i.feature.attributes.Certificat+"</td></tr>",content+="<tr><td>Certificate Issue Date</td><td>"+i.feature.attributes.Issued+"</td></tr>",content+="<tr><td>Certificate Expiry Date</td><td>"+i.feature.attributes.Expired+"</td></tr>",content+="<tr><td>Mill name</td><td>"+i.feature.attributes.Mill+"</td></tr>",content+="<tr><td>Mill location</td><td>"+i.feature.attributes.Location+"</td></tr>",content+="<tr><td>Mill capacity (t/hour)</td><td>"+i.feature.attributes.Capacity+"</td></tr>",content+="<tr><td>Certified CPO (mt)</td><td>"+i.feature.attributes.CPO+"</td></tr>",content+="<tr><td>Certified PK (mt)</td><td>"+i.feature.attributes.PK+"</td></tr>",content+="<tr><td>Estate Suppliers</td><td>"+i.feature.attributes.Estate+"</td></tr>",content+="<tr><td>Estate Area (ha)</td><td>"+i.feature.attributes.Estate_1+"</td></tr>",content+="<tr><td>Outgrower Area (ha)</td><td>"+i.feature.attributes.Outgrowe+"</td></tr>",content+="<tr><td>Scheme Smallholder Area (ha)</td><td>"+i.feature.attributes.SH+"</td></tr>"):(content+="<tr class='infoName'><td colspan='2'>"+i.feature.attributes.NAME+"</td></tr>",content+="<tr><td>Concession Type</td><td>"+i.feature.attributes.TYPE+"</td></tr>",content+="<tr><td>Country</td><td>"+i.feature.attributes.Country+"</td></tr>",content+="<tr><td>Group</td><td>"+i.feature.attributes.GROUP_NAME+"</td></tr>",content+="<tr><td>Certification Status</td><td>"+i.feature.attributes.CERT_STAT+"</td></tr>",content+="<tr><td>GIS Calculated Area (ha)</td><td>"+i.feature.attributes.AREA_HA+"</td></tr>"),content+="<tr><td>Source: </td><td>"+(i.feature.attributes.Source||"N/A")+"</td></tr>",content+="</table>",n.infoWindow.setContent(content),n.infoWindow.show(a.mapPoint),r.once(t.byId("closePopup"),"click",function(){n.infoWindow.hide()}))},function(t){console.dir(t)})}},getActiveFiresInfoWindow:function(a){var n=o.firesLayer,i=this,s=n.url,d=new u(s),f=new c,y=a.mapPoint;f.geometry=y,f.tolerance=1,f.returnGeometry=!1,f.mapExtent=l.extent,f.layerOption=c.LAYER_OPTION_VISIBLE;var p=!0,b="<div id='closePopup' class='close-icon'></div><table id='infoWindowTable'>";d.execute(f,function(s){var o=l,d=s[0];d?(p=!1,b+="<tr class='infoName'><td colspan='3'>Active Fires</td><td colspan='2'></td></tr>",e.forEach(n.query.fields,function(t){b+="<tr><td colspan='3'>"+t.label+"</td>",b+="<td colspan='2'>"+d.feature.attributes[t.name]+"</td></tr>"}),b+="</table>",o.infoWindow.setContent(b),o.infoWindow.show(y),r.once(t.byId("closePopup"),"click",function(){o.infoWindow.hide()})):i.mapClick(a)},function(t){console.log(t),i.mapClick(a)})}}});
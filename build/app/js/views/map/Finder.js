define(["dojo/dom","dojo/_base/array","dojo/on","dojo/query","esri/graphic","esri/geometry/Point","esri/geometry/webMercatorUtils","esri/symbols/PictureMarkerSymbol","views/map/MapConfig","views/map/MapModel","esri/tasks/IdentifyTask","esri/tasks/IdentifyParameters"],function(t,e,r,a,n,i,s,o,d,u,c,l){var f;return{setMap:function(t){f=t},searchAreaByCoordinates:function(){var r,a,d,c,l={},y=!1,b="You did not enter a valid value.  Please check that your location values are all filled in and nubmers only.",p=new o("app/images/RedStickpin.png",32,32),m={},v=function(t){return y||(y=isNaN(parseInt(t))),isNaN(parseInt(t))?0:parseInt(t)},g=function(){var t=0;return e.forEach(f.graphics.graphics,function(e){e.attribtues&&e.attributes.locatorValue&&(t=Math.max(t,parseInt(e.attributes.locatorValue)))}),t};u.get("showDMSInputs")?(l.dlat=v(t.byId("degreesLatInput").value),l.mlat=v(t.byId("minutesLatInput").value),l.slat=v(t.byId("secondsLatInput").value),l.dlon=v(t.byId("degreesLonInput").value),l.mlon=v(t.byId("minutesLonInput").value),l.slon=v(t.byId("secondsLonInput").value),r=l.dlat+l.mlat/60+l.slat/3600,a=l.dlon+l.mlon/60+l.slon/3600):(r=v(t.byId("latitudeInput").value),a=v(t.byId("longitudeInput").value)),y?alert(b):(d=s.geographicToWebMercator(new i(a,r)),m.locatorValue=g(),m.id="LOCATOR_"+m.locatorValue,c=new n(d,p,m),f.graphics.add(c),f.centerAndZoom(d,7),u.set("showClearPinsOption",!0))},fetchTwitterData:function(t){var e=t.target?t.target:t.srcElement;!e.checked},mapClick:function(a){var n=f;if(forestUseLayer=n.getLayer(d.forestUseLayers.id),conservationLayers=n.getLayer(d.conservationLayers.id),visLayers=[],isVisLayers=forestUseLayer.visibleLayers.indexOf(10)>-1||conservationLayers.visible||forestUseLayer.visibleLayers.indexOf(26)>-1||forestUseLayer.visibleLayers.indexOf(27)>-1||forestUseLayer.visibleLayers.indexOf(28)>-1||forestUseLayer.visibleLayers.indexOf(32)>-1,visible=forestUseLayer.visible,e.forEach(forestUseLayer.visibleLayers,function(t){visLayers.push(t)}),conservationLayers.visible&&visLayers.push(25),Array.prototype.move=function(t,e){this.splice(e,0,this.splice(t,1)[0])},visLayers.move(visLayers.indexOf(27),0),isVisLayers){var i=new c(forestUseLayer.url);identifyParams=new l,identifyParams.tolerance=3,identifyParams.returnGeometry=!0,identifyParams.layerIds=visLayers,identifyParams.width=n.width,identifyParams.height=n.height,identifyParams.geometry=a.mapPoint,identifyParams.mapExtent=n.extent,i.execute(identifyParams,function(e){var i=e[0];i&&(content="<div id='closePopup' class='close-icon'></div><table id='infoWindowTable'>",25==i.layerId?(content+="<tr class='infoName'><td colspan='2'>"+i.feature.attributes.NAME+"</td></tr>",content+="<tr><td>Local Name</td><td>"+i.feature.attributes.ORIG_NAME+"</td></tr>",content+="<tr><td>Legal Designation</td><td>"+i.feature.attributes.DESIG_ENG+"</td></tr>",content+="<tr><td>WDPA ID</td><td>"+i.feature.attributes.WDPAID+"</td></tr>"):27==i.layerId?(content+="<tr class='infoName'><td colspan='2'>"+i.feature.attributes.NAME+"</td></tr>",content+="<tr><td>Concession Type</td><td>"+i.feature.attributes.TYPE+"</td></tr>",content+="<tr><td>Country</td><td>"+i.feature.attributes.Country+"</td></tr>",content+="<tr><td>Certification Status</td><td>"+i.feature.attributes.CERT_STAT+"</td></tr>",content+="<tr><td>GIS Calculated Area (ha)</td><td>"+i.feature.attributes.AREA_HA+"</td></tr>",content+="<tr><td>Certificate ID</td><td>"+i.feature.attributes.Certificat+"</td></tr>",content+="<tr><td>Certificate Issue Date</td><td>"+i.feature.attributes.Issued+"</td></tr>",content+="<tr><td>Certificate Expiry Date</td><td>"+i.feature.attributes.Expired+"</td></tr>",content+="<tr><td>Mill name</td><td>"+i.feature.attributes.Mill+"</td></tr>",content+="<tr><td>Mill location</td><td>"+i.feature.attributes.Location+"</td></tr>",content+="<tr><td>Mill capacity (t/hour)</td><td>"+i.feature.attributes.Capacity+"</td></tr>",content+="<tr><td>Certified CPO (mt)</td><td>"+i.feature.attributes.CPO+"</td></tr>",content+="<tr><td>Certified PK (mt)</td><td>"+i.feature.attributes.PK+"</td></tr>",content+="<tr><td>Estate Suppliers</td><td>"+i.feature.attributes.Estate+"</td></tr>",content+="<tr><td>Estate Area (ha)</td><td>"+i.feature.attributes.Estate_1+"</td></tr>",content+="<tr><td>Outgrower Area (ha)</td><td>"+i.feature.attributes.Outgrowe+"</td></tr>",content+="<tr><td>Scheme Smallholder Area (ha)</td><td>"+i.feature.attributes.SH+"</td></tr>"):(content+="<tr class='infoName'><td colspan='2'>"+i.feature.attributes.NAME+"</td></tr>",content+="<tr><td>Concession Type</td><td>"+i.feature.attributes.TYPE+"</td></tr>",content+="<tr><td>Country</td><td>"+i.feature.attributes.Country+"</td></tr>",content+="<tr><td>Certification Status</td><td>"+i.feature.attributes.CERT_STAT+"</td></tr>",content+="<tr><td>GIS Calculated Area (ha)</td><td>"+i.feature.attributes.AREA_HA+"</td></tr>"),content+="<tr><td>Source: </td><td>"+(i.feature.attributes.Source||"N/A")+"</td></tr>",content+="</table>",n.infoWindow.setContent(content),n.infoWindow.show(a.mapPoint),r.once(t.byId("closePopup"),"click",function(){n.infoWindow.hide()}))},function(t){console.dir(t)})}},getActiveFiresInfoWindow:function(t){var r=d.firesLayer,n=this,i=r.url,s=new c(i),o=new l,u=t.mapPoint,y=!0,b=a(".selected-fire-option")[0],p=new Date,m="",v=[];switch(b.id){case"fires72":p=new Date(p.getFullYear(),p.getMonth(),p.getDate()-3);break;case"fires48":p=new Date(p.getFullYear(),p.getMonth(),p.getDate()-2);break;case"fires24":p=new Date(p.getFullYear(),p.getMonth(),p.getDate()-1);break;default:p=new Date(p.getFullYear(),p.getMonth(),p.getDate()-7)}m=p.getFullYear()+"-"+(p.getMonth()+1)+"-"+p.getDate()+" "+p.getHours()+":"+p.getMinutes()+":"+p.getSeconds();for(var g=0,h=d.firesLayer.defaultLayers.length;h>g;g++)v[g]="ACQ_DATE > date '"+m+"'";o.geometry=u,o.tolerance=3,o.returnGeometry=!1,o.layerDefinitions=v,o.mapExtent=f.extent,o.layerOption=l.LAYER_OPTION_VISIBLE;var L="</div><table id='infoWindowTable'>";s.execute(o,function(a){var i=f,s=a[0];s?(y=!1,L+="<tr class='infoName'><td colspan='3'>Active Fires</td><td colspan='2'></td></tr>",e.forEach(r.query.fields,function(t){L+="<tr><td colspan='3'>"+t.label+"</td>",L+="<td colspan='2'>"+s.feature.attributes[t.name]+"</td></tr>"}),L+="</table>",i.infoWindow.setContent(L),i.infoWindow.show(u)):n.mapClick(t)},function(e){console.log(e),n.mapClick(t)})},getFireTweetsInfoWindow:function(t){f.infoWindow.anchor="ANCHOR_UPPERRIGHT";var e=t.attributes,r="<table><tr><td>";return r+="<td><img src='"+e.UserProfileImage+"'/></td>",r+="<td>"+e.UserName+"</td></tr>",r+="<p>"+e.Text+"</p>",r+="<p>"+e.Date+"</p>"}}});
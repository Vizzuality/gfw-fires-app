define(["dojo/dom","dijit/registry","modules/HashController","modules/EventsController","views/home/HomeModel","dojo/_base/array","views/map/MapConfig"],function(dom,registry,HashController,EventsController,HomeModel,arrayUtil,MapConfig){var o={},initialized=!1,viewName="homeView",viewObj={viewId:"homeView",viewName:"home"},stopAnimation=!1;return o.init=function(){return initialized?(EventsController.switchToView(viewObj),void EventsController.startModeAnim()):void require(["dojo/text!views/home/home.html"],function(e){initialized=!0,dom.byId(viewName).innerHTML=e,EventsController.switchToView(viewObj),HomeModel.applyBindings(viewName),EventsController.getPeats()})},o.startModeAnim=function(){console.log("start mode animation"),stopAnimation=!1;var e=1,o=function(e){var o=HomeModel.vm.homeModeOptions(),t=arrayUtil.map(o,function(o,t){return o.display=t===e?!0:!1,o});HomeModel.vm.homeModeOptions([]),HomeModel.vm.homeModeOptions(t)};o(e),require(["dojo/fx","dojo/_base/fx","dojo/query"],function(t,i,n){var r=function(a){var s=n(".modeGroup"),l=s.length,d=t.chain([i.animateProperty({node:s[a],properties:{marginLeft:{start:0,end:-350},opacity:{start:1,end:0}},onEnd:function(){var t;l-1>e?(t=e+1,e++):(t=0,e=0),setTimeout(function(){o(t),stopAnimation||setTimeout(function(){r(t)},4e3)},500)},units:"px",duration:500})]);d.play()};r(e)})},o.getPeats=function(){require(["modules/Loader","modules/ErrorController","dojo/promise/all"],function(e,o,t){var i=new Date,n=new Date;n.setDate(i.getDate()-8);var r=n.getFullYear(),a="00"+(n.getMonth()+1).toString();a=a.substr(a.length-2);var s="00"+n.getDate().toString();s=s.substr(s.length-2);var l=r.toString()+"-"+a+"-"+s,d={layer:"http://gis-potico.wri.org/arcgis/rest/services/Fires/FIRMS_ASEAN/MapServer/0",where:"peat = 1 AND ACQ_DATE > date '"+l+" 12:00:00'",type:"executeForCount"},m=e.query(d),u={layer:"http://gis-potico.wri.org/arcgis/rest/services/Fires/FIRMS_ASEAN/MapServer/0",where:"ACQ_DATE > date '"+l+" 12:00:00'",type:"executeForCount"},c=e.query(u);t([m,c]).then(function(e){var o=e[0],t=e[1],i=Math.round(o/t*100),n=HomeModel.vm.homeModeOptions(),r=0,a="";arrayUtil.some(n,function(e,o){var t=e.html.indexOf("Fires occuring in peatland")>-1;return t&&(r=o,a=e.html.replace("Fires occuring in peatland","<p>"+i.toString()+" %</p> Fires occuring in peatland")),t}),n[r].html=a,HomeModel.vm.homeModeOptions(n),EventsController.startModeAnim()})})},o.stopModeAnim=function(){stopAnimation=!0,console.log("stop mode animation ")},o.getAnimStatus=function(){return stopAnimation},o.modeSelect=function(data){var selectedMode=data;eval("EventsController."+selectedMode.eventName+"()"),data.html&&data.html.search("latest imagery")>-1&&require(["views/map/LayerController"],function(e){e.updateLayersInHash("add",MapConfig.digitalGlobe.id,MapConfig.digitalGlobe.id),registry.byId("digital-globe-checkbox")&&registry.byId("digital-globe-checkbox").set("checked",!0)})},o.isInitialized=function(){return initialized},o});
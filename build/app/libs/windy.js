var Windy=function(t){var n=1/7e4,r=10,e=40,a=100,o=.8,i=8,f=.75,u=20,h=[0/0,0/0,null],c=(2*Math.PI,Math.pow(10,-5.2),function(t,n,r,e,a,o){var i=1-t,f=1-n,u=i*f,h=t*f,c=i*n,d=t*n,l=r[0]*u+e[0]*h+a[0]*c+o[0]*d,s=r[1]*u+e[1]*h+a[1]*c+o[1]*d;return[l,s,Math.sqrt(l*l+s*s)]}),d=function(t,n){var r=t.data,e=n.data;return{header:t.header,data:function(t){return[r[t],e[t]]},interpolate:c}},l=function(t){var n=null,r=null,e=null;return t.forEach(function(t){switch(t.header.parameterCategory+","+t.header.parameterNumber){case"2,2":n=t;break;case"2,3":r=t;break;default:e=t}}),d(n,r)},s=function(t,n){function r(t,n){var r,a=M(t-o,360)/f,h=(i-n)/u,c=Math.floor(a),d=c+1,l=Math.floor(h),g=l+1;if(r=s[l]){var w=r[c],b=r[d];if(m(w)&&m(b)&&(r=s[g])){var v=r[c],p=r[d];if(m(v)&&m(p))return e.interpolate(a-c,h-l,w,b,v,p)}}return null}var e=l(t),a=e.header,o=a.lo1,i=a.la1,f=a.dx,u=a.dy,h=a.nx,c=a.ny,d=new Date(a.refTime);d.setHours(d.getHours()+a.forecastTime);for(var s=[],g=0,w=Math.floor(h*f)>=360,b=0;c>b;b++){for(var v=[],p=0;h>p;p++,g++)v[p]=e.data(g);w&&v.push(v[0]),s[b]=v}n({date:d,interpolate:r})},m=function(t){return null!==t&&void 0!==t},M=function(t,n){return t-n*Math.floor(t/n)},g=function(){return/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i.test(navigator.userAgent)},w=function(t,n,r,e,a,o,i,f){var u=i[0]*o,h=i[1]*o,c=b(t,n,r,e,a,f);return i[0]=c[0]*u+c[2]*h,i[1]=c[1]*u+c[3]*h,i},b=function(t,n,r,e,a,o){var i=2*Math.PI,f=Math.pow(10,-5.2),u=0>n?f:-f,h=0>r?f:-f,c=A(r,n+u,o),d=A(r+h,n,o),l=Math.cos(r/360*i);return[(c[0]-e)/u/l,(c[1]-a)/u/l,(d[0]-e)/h,(d[1]-a)/h]},v=function(t,n,r){function e(n,r){var e=t[Math.round(n)];return e&&e[Math.round(r)]||h}e.release=function(){t=[]},e.randomize=function(t){var r,a,o=0;do r=Math.round(Math.floor(Math.random()*n.width)+n.x),a=Math.round(Math.floor(Math.random()*n.height)+n.y);while(null===e(r,a)[2]&&o++<30);return t.x=r,t.y=a,t},r(n,e)},p=function(t,n,r){var e=t[0],a=t[1],o=Math.round(e[0]),i=Math.max(Math.floor(e[1],0),0),f=(Math.min(Math.ceil(a[0],n),n-1),Math.min(Math.ceil(a[1],r),r-1));return{x:o,y:i,xMax:n,yMax:f,width:n,height:r}},x=function(t){return t/180*Math.PI},y=function(t){return t/(Math.PI/180)},I=function(t,n,r){var e=r.east-r.west,a=r.width/y(e)*360/(2*Math.PI),o=a/2*Math.log((1+Math.sin(r.south))/(1-Math.sin(r.south))),i=r.height+o,f=(i-n)/a,u=180/Math.PI*(2*Math.atan(Math.exp(f))-Math.PI/2),h=y(r.west)+t/r.width*y(e);return[h,u]},F=function(t){return Math.log(Math.tan(t/2+Math.PI/4))},A=function(t,n,r){var e=F(r.south),a=F(r.north),o=r.width/(r.east-r.west),i=r.height/(a-e),f=F(x(t)),u=(x(n)-r.west)*o,f=(a-f)*i;return[u,f]},P=function(t,r,e,a){function o(n){for(var a=[],o=r.y;o<=r.yMax;o+=2){var h=I(n,o,e);if(h){var c=h[0],d=h[1];if(isFinite(c)){var l=t.interpolate(c,d);l&&(l=w(i,c,d,n,o,f,l,e),a[o+1]=a[o]=l)}}}u[n+1]=u[n]=a}var i={},f=r.height*n,u=[],h=r.x;!function c(){for(var t=Date.now();h<r.width;)if(o(h),h+=2,Date.now()-t>1e3)return void setTimeout(c,25);v(u,r,a)}()},q=function(n,h){function c(t){return parseInt(s(t).substring(0,2),16)}function d(t){return parseInt(s(t).substring(2,4),16)}function l(t){return parseInt(s(t).substring(4,6),16)}function s(t){return"#"==t.charAt(0)?t.substring(1,7):t}function m(t,n){return result=["rgba("+c("#00ffff")+", "+d("#00ffff")+", "+l("#00ffff")+", 0.5)","rgba("+c("#64f0ff")+", "+d("#64f0ff")+", "+l("#64f0ff")+", 0.5)","rgba("+c("#87e1ff")+", "+d("#87e1ff")+", "+l("#87e1ff")+", 0.5)","rgba("+c("#a0d0ff")+", "+d("#a0d0ff")+", "+l("#a0d0ff")+", 0.5)","rgba("+c("#b5c0ff")+", "+d("#b5c0ff")+", "+l("#b5c0ff")+", 0.5)","rgba("+c("#c6adff")+", "+d("#c6adff")+", "+l("#c6adff")+", 0.5)","rgba("+c("#d49bff")+", "+d("#d49bff")+", "+l("#d49bff")+", 0.5)","rgba("+c("#e185ff")+", "+d("#e185ff")+", "+l("#e185ff")+", 0.5)","rgba("+c("#ec6dff")+", "+d("#ec6dff")+", "+l("#ec6dff")+", 0.5)","rgba("+c("#ff1edb")+", "+d("#ff1edb")+", "+l("#ff1edb")+", 0.5)"],result.indexFor=function(t){return Math.floor(Math.min(t,n)/n*(result.length-1))},result}function M(){v.forEach(function(t){t.length=0}),y.forEach(function(t){t.age>a&&(h.randomize(t).age=0);var n=t.x,r=t.y,e=h(n,r),o=e[2];if(null===o)t.age=a;else{var i=n+e[0],f=r+e[1];null!==h(i,f)[2]?(t.xt=i,t.yt=f,v[b.indexFor(o)].push(t)):(t.x=i,t.y=f)}t.age+=1})}function w(){var t=F.globalCompositeOperation;F.globalCompositeOperation="destination-in",F.fillRect(n.x,n.y,n.width,n.height),F.globalCompositeOperation=t,v.forEach(function(t,n){t.length>0&&(F.beginPath(),F.strokeStyle=b[n],t.forEach(function(t){F.moveTo(t.x,t.y),F.lineTo(t.xt,t.yt),t.x=t.xt,t.y=t.yt}),F.stroke())})}var b=m(r,e),v=b.map(function(){return[]}),p=Math.round(n.width*i);g()&&(p*=f);for(var x="rgba(0, 0, 0, 0.97)",y=[],I=0;p>I;I++)y.push(h.randomize({age:Math.floor(Math.random()*a)+0}));var F=t.canvas.getContext("2d");F.lineWidth=o,F.fillStyle=x,function A(){try{C.timer=setTimeout(function(){requestAnimationFrame(A),M(),w()},1e3/u)}catch(t){console.error(t)}}()},T=function(n,r,e,a){var o={south:x(a[0][1]),north:x(a[1][1]),east:x(a[1][0]),west:x(a[0][0]),width:r,height:e};k(),s(t.data,function(t){P(t,p(n,r,e),o,function(t,n){C.field=n,q(t,n)})})},k=function(){C.field&&C.field.release(),C.timer&&clearTimeout(C.timer)},C={params:t,start:T,stop:k};return C};window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,50)}}();